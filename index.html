<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#f8d9e7">
  <link rel="apple-touch-icon" href="appicon.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>Daily Expenses Tracker üéÄ</title>
  <style>
    body {
      margin: 0;
      font-family: 'Quicksand', sans-serif;
      background: url(''https://i.pinimg.com/736x/58/09/12/5809128d95aee17fdad43073ef5495be.jpg') no-repeat center center fixed;
      background-size: cover;
      color: #333;
    }

    .container {
      max-width: 700px;
      margin: 2rem auto;
      background: rgba(255, 255, 255, 0.9);
      padding: 2rem;
      border-radius: 16px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
    }

    h1 {
      text-align: center;
      color: #d46fa7;
    }

    nav {
      display: flex;
      justify-content: space-around;
      margin-bottom: 1rem;
    }

    nav button {
      background: #f8d9e7;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 999px;
      font-weight: bold;
      cursor: pointer;
    }

    nav button.active {
      background: #d46fa7;
      color: white;
    }

    .tab {
      display: none;
    }

    .tab.active {
      display: block;
    }

    input,
    select,
    button,
    textarea {
      display: block;
      width: 100%;
      padding: 0.5rem;
      margin-bottom: 1rem;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }

    th,
    td {
      padding: 0.5rem;
      border-bottom: 1px solid #ccc;
    }

    .edit-btn {
      cursor: pointer;
      color: #d46fa7;
    }

    .delete-btn {
      cursor: pointer;
      color: #ff6b6b;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>Daily Expenses Tracker üéÄ</h1>
    <nav>
      <button onclick="switchTab('add')" class="active">Add</button>
      <button onclick="switchTab('view')">View</button>
      <button onclick="switchTab('profit')">Profit</button>
      <button onclick="switchTab('investment')">Investment</button>
    </nav>

    <div id="add" class="tab active">
      <label>Date: <input type="date" id="dateInput" /></label>
      <label>Amount: <input type="number" id="amountInput" /></label>
      <label>Note: <textarea id="noteInput"></textarea></label>
      <button onclick="addTransaction()">Save</button>
    </div>

    <div id="view" class="tab">
      <label>Month & Year:
        <select id="viewMonthYear" onchange="renderTransactions()"></select>
      </label>
      <div id="totalView"></div>
      <table id="transactionTable"></table>
    </div>

    <div id="profit" class="tab">
      <label>Month & Year:
        <select id="profitMonthYear" onchange="fetchProfit()"></select>
      </label>
      <div id="profitAmount">Loading...</div>
    </div>

    <div id="investment" class="tab">
      <div id="investmentData">Loading...</div>
    </div>
  </div>

  <script>
    let transactions = JSON.parse(localStorage.getItem('transactions') || '[]');

    function switchTab(tabId) {
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
      event.target.classList.add('active');
      if (tabId === 'view') renderTransactions();
      if (tabId === 'profit') fetchProfit();
      if (tabId === 'investment') fetchInvestment();
    }

    function addTransaction() {
      const date = document.getElementById('dateInput').value;
      const amount = parseFloat(document.getElementById('amountInput').value);
      const note = document.getElementById('noteInput').value;
      if (!date || isNaN(amount)) return;
      transactions.push({ date, amount, note });
      localStorage.setItem('transactions', JSON.stringify(transactions));
      alert('Saved!');
    }

    function renderTransactions() {
      const selector = document.getElementById('viewMonthYear');
      const [month, year] = selector.value.split(' ');
      const table = document.getElementById('transactionTable');
      const total = document.getElementById('totalView');
      let html = '<tr><th>Date</th><th>Amount</th><th>Note</th><th>Edit</th><th>Delete</th></tr>';
      let totalVal = 0;
      transactions.forEach((t, i) => {
        const d = new Date(t.date);
        const m = d.toLocaleString('default', { month: 'long' });
        const y = d.getFullYear().toString();
        if (m === month && y === year) {
          totalVal += t.amount;
          html += `<tr>
            <td><input type="date" value="${t.date}" onchange="transactions[${i}].date = this.value; save()" /></td>
            <td><input type="number" value="${t.amount}" onchange="transactions[${i}].amount = parseFloat(this.value); save()" /></td>
            <td><input value="${t.note}" onchange="transactions[${i}].note = this.value; save()" /></td>
            <td class='edit-btn'>‚úîÔ∏è</td>
            <td class='delete-btn' onclick="deleteTransaction(${i})">üóë</td>
          </tr>`;
        }
      });
      table.innerHTML = html;
      total.innerText = `Total: ‚Çπ${totalVal.toFixed(2)}`;
    }

    function deleteTransaction(i) {
      if (confirm('Delete this transaction?')) {
        transactions.splice(i, 1);
        save();
      }
    }

    function save() {
      localStorage.setItem('transactions', JSON.stringify(transactions));
      renderTransactions();
    }

    function initMonthYearDropdowns() {
      const months = [...new Set(transactions.map(t => {
        const d = new Date(t.date);
        return `${d.toLocaleString('default', { month: 'long' })} ${d.getFullYear()}`;
      }))].sort((a, b) => new Date(b) - new Date(a));

      const viewSelect = document.getElementById('viewMonthYear');
      const profitSelect = document.getElementById('profitMonthYear');
      viewSelect.innerHTML = '';
      profitSelect.innerHTML = '';
      months.forEach(m => {
        viewSelect.innerHTML += `<option value="${m}">${m}</option>`;
        profitSelect.innerHTML += `<option value="${m}">${m}</option>`;
      });
      if (months.length > 0) {
        viewSelect.value = months[0];
        profitSelect.value = months[0];
      }
    }

    async function fetchProfit() {
      const data = await fetch('https://opensheet.elk.sh/1UMul8nt25GR8MUM-_EdwAR0q6Ne2ovPv_R-m1-CHeXw/Profit%20Sheet').then(res => res.json());
      const selected = document.getElementById('profitMonthYear').value;
      const entry = data.find(row => row['Month'] === selected);
      document.getElementById('profitAmount').innerText = entry ? `Profit: ‚Çπ${entry['Profit']}` : 'No data';
    }

    async function fetchInvestment() {
      const data = await fetch('https://opensheet.elk.sh/1UMul8nt25GR8MUM-_EdwAR0q6Ne2ovPv_R-m1-CHeXw/Vendor%20Sales%20Record').then(res => res.json());
      const display = document.getElementById('investmentData');
      let html = '<h3>Investment Summary</h3><ul>';

      const fixedRows = [
        { name: 'Available Wallet', row: 0 },
        { name: 'Reseller Amount Due', row: 1 },
        { name: 'Client Due', row: 2 },
        { name: 'Total Amount Invested', row: 3 }
      ];

      fixedRows.forEach(item => {
        const value = data[item.row]?.['Amount'] || data[item.row]?.['J'] || '';
        html += `<li>${item.name}: ‚Çπ${value}</li>`;
      });

      html += '</ul><h3>Vendor Balances</h3><ul>';

      data.forEach(row => {
        const name = row['Vendor name'] || row['B'];
        const balance = parseFloat(row['Balance'] || row['F']);
        if (!isNaN(balance) && balance !== 0) {
          html += `<li>${name}: ‚Çπ${balance}</li>`;
        }
      });

      html += '</ul>';
      display.innerHTML = html;
    }

    initMonthYearDropdowns();
    renderTransactions();
  </script>
</body>

</html>
