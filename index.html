<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#fcd6e0" />
  <link rel="manifest" href="manifest.json" />
  <title>Daily Expenses Tracker ðŸŽ€</title>
  <style>
    body {
      font-family: 'Quicksand', sans-serif;
      margin: 0;
      background: url('https://i.pinimg.com/736x/58/09/12/5809128d95aee17fdad43073ef5495be.jpg') no-repeat center center fixed;
      background-size: cover;
    }
    .container {
      background-color: rgba(255, 255, 255, 0.85);
      max-width: 600px;
      margin: 20px auto;
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
    }
    h1, h2, h3 {
      text-align: center;
      color: #c06c84;
    }
    .tabs {
      display: flex;
      justify-content: space-around;
      margin-bottom: 20px;
    }
    .tab-button {
      flex: 1;
      padding: 10px;
      border: none;
      background-color: #f9cfdc;
      color: #fff;
      font-weight: bold;
      border-radius: 20px;
      margin: 0 5px;
      cursor: pointer;
    }
    .tab-button.active {
      background-color: #f08ca1;
    }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    input, textarea, select {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: 1px solid #ddd;
      border-radius: 10px;
    }
    .entry {
      background-color: #ffe6ec;
      padding: 10px;
      border-radius: 10px;
      margin: 10px 0;
    }
    .entry span {
      display: inline-block;
      width: 100px;
    }
    .edit-btn, .delete-btn, .save-btn {
      margin-left: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Daily Expenses Tracker ðŸŽ€</h1>
    <div class="tabs">
      <button class="tab-button active" data-tab="add">âž• Add</button>
      <button class="tab-button" data-tab="view">ðŸ“… View</button>
      <button class="tab-button" data-tab="profit">ðŸ’° Profit</button>
      <button class="tab-button" data-tab="investment">ðŸ“Š Investment</button>
    </div>
    <div id="add" class="tab-content active">
      <input type="date" id="expense-date" />
      <input type="number" id="expense-amount" placeholder="Expense Amount" />
      <textarea id="expense-note" placeholder="Comment/Note"></textarea>
      <button onclick="addTransaction()">Add Transaction</button>
      <div id="transaction-list"></div>
    </div>
    <div id="view" class="tab-content">
      <select id="view-month"></select>
      <div id="monthly-total"></div>
      <div id="monthly-transactions"></div>
    </div>
    <div id="profit" class="tab-content">
      <select id="profit-month"></select>
      <div id="profit-value"></div>
    </div>
    <div id="investment" class="tab-content">
      <div id="investment-summary"></div>
      <div id="vendor-balances"></div>
    </div>
  </div>

  <script>
    const transactions = [];

    document.addEventListener("DOMContentLoaded", () => {
      document.querySelectorAll(".tab-button").forEach(btn => {
        btn.addEventListener("click", () => {
          document.querySelectorAll(".tab-button").forEach(b => b.classList.remove("active"));
          document.querySelectorAll(".tab-content").forEach(tab => tab.classList.remove("active"));
          btn.classList.add("active");
          document.getElementById(btn.dataset.tab).classList.add("active");
          if (btn.dataset.tab === "profit") fetchProfit();
          if (btn.dataset.tab === "investment") fetchInvestment();
        });
      });

      document.getElementById("expense-date").valueAsDate = new Date();
      fetchProfit();
      fetchInvestment();
    });

    function addTransaction() {
      const date = document.getElementById("expense-date").value;
      const amount = parseFloat(document.getElementById("expense-amount").value);
      const note = document.getElementById("expense-note").value;
      if (!date || isNaN(amount)) return;
      transactions.push({ date, amount, note });
      renderTransactions();
      document.getElementById("expense-amount").value = "";
      document.getElementById("expense-note").value = "";
    }

    function renderTransactions() {
      const list = document.getElementById("transaction-list");
      list.innerHTML = transactions.map((t, i) => `
        <div class="entry">
          <input type="date" value="${t.date}" onchange="transactions[${i}].date = this.value" />
          <input type="number" value="${t.amount}" onchange="transactions[${i}].amount = parseFloat(this.value)" />
          <input type="text" value="${t.note}" onchange="transactions[${i}].note = this.value" />
        </div>
      `).join("");

      const monthSet = new Set(transactions.map(t => {
        const d = new Date(t.date);
        return `${d.toLocaleString('default', { month: 'long' })} ${d.getFullYear()}`;
      }));

      const viewMonthSelect = document.getElementById("view-month");
      viewMonthSelect.innerHTML = "";
      Array.from(monthSet).sort().forEach(m => {
        const option = document.createElement("option");
        option.value = m;
        option.textContent = m;
        viewMonthSelect.appendChild(option);
      });

      viewMonthSelect.onchange = () => {
        const selected = viewMonthSelect.value;
        const filtered = transactions.filter(t => {
          const d = new Date(t.date);
          return `${d.toLocaleString('default', { month: 'long' })} ${d.getFullYear()}` === selected;
        });
        const total = filtered.reduce((sum, t) => sum + t.amount, 0);
        document.getElementById("monthly-total").textContent = `Total: â‚¹${total}`;
        document.getElementById("monthly-transactions").innerHTML = filtered.map(t => `
          <div class="entry">${t.date} - â‚¹${t.amount} - ${t.note}</div>
        `).join("");
      };

      viewMonthSelect.dispatchEvent(new Event("change"));
    }

    async function fetchProfit() {
      const res = await fetch("https://opensheet.elk.sh/1UMul8nt25GR8MUM-_EdwAR0q6Ne2ovPv_R-m1-CHeXw/Profit%20Sheet");
      const data = await res.json();
      const profitSelect = document.getElementById("profit-month");
      profitSelect.innerHTML = "";
      data.forEach(row => {
        if (row.Month && row.Profit) {
          const opt = document.createElement("option");
          opt.value = row.Month;
          opt.textContent = row.Month;
          profitSelect.appendChild(opt);
        }
      });
      const latest = data[data.length - 1];
      profitSelect.value = latest.Month;
      document.getElementById("profit-value").textContent = `Profit: â‚¹${latest.Profit}`;
      profitSelect.onchange = () => {
        const selected = data.find(r => r.Month === profitSelect.value);
        document.getElementById("profit-value").textContent = `Profit: â‚¹${selected?.Profit || 0}`;
      };
    }

    async function fetchInvestment() {
      const res = await fetch("https://opensheet.elk.sh/1UMul8nt25GR8MUM-_EdwAR0q6Ne2ovPv_R-m1-CHeXw/Vendor%20Sales%20Record");
      const rows = await res.json();
      const summary = document.getElementById("investment-summary");
      const balances = document.getElementById("vendor-balances");

      const summaryLabels = ["Available Wallet", "Reseller Amount Due", "Client Due", "Total Amount Invested"];
      let summaryHTML = "";
      for (let i = 2; i <= 5; i++) {
        const label = summaryLabels[i - 2];
        const value = rows[i - 2]?.["Amount"] || "0";
        summaryHTML += `<div class="entry">${label}: â‚¹${value}</div>`;
      }
      summary.innerHTML = summaryHTML;

      let balanceHTML = "";
      for (const row of rows) {
        const name = row["Vendor name"];
        const balance = row["Balance"];
        if (!name || isNaN(balance) || parseFloat(balance) === 0) continue;
        balanceHTML += `<div class="entry">${name}: â‚¹${balance}</div>`;
      }
      balances.innerHTML = balanceHTML;
    }
  </script>
</body>
</html>
